package com.david.dshopapi.web.controller;


import com.david.dshopapi.core.Result;
import com.david.dshopapi.core.ResultGenerator;
import com.david.dshopapi.model.User;
import com.david.dshopapi.service.UserService;
import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;
import java.util.List;

/**
 * @author ：David
 * @weibo ：http://weibo.com/mcxiaobing
 * @github: https://github.com/QQ986945193
 */
@RestController
@RequestMapping("/user")
public class UserController {
    @Resource
    private UserService userService;

    /**
     *
     {
     "code": 500,
     "message": "接口 [/user/add] 内部错误，请联系管理员"
     }

     {
     "code": 200,
     "data": null,
     "message": "SUCCESS"
     }

     */
    @PostMapping("/add")
    public Result add(User user) {
        userService.save(user);
        return ResultGenerator.genSuccessResult();
    }

    @PostMapping("/delete")
    public Result delete(@RequestParam Integer id) {
        userService.deleteById(id);
        return ResultGenerator.genSuccessResult();
    }

    @PostMapping("/update")
    public Result update(User user) {
        userService.update(user);
        return ResultGenerator.genSuccessResult();
    }
    /**
     *
     {
     "code": 200,
     "data": {
     "age": 30,
     "uid": 1,
     "username": "david"
     },
     "message": "SUCCESS"
     }

     {
     "code": 500,
     "message": "接口 [/user/detail] 内部错误，请联系管理员"
     }
     */
    @PostMapping("/detail")
    public Result detail(@RequestParam Integer id) {
        User user = userService.findById(id);
        // 故意搞一个异常
        //   int num = 100/0;
        return ResultGenerator.genSuccessResult(user);
    }

    /**
     * http://localhost:8080/user/list?page=1&size=1
     * @param page 当前页 从第1页开始
     * @param size 每页显示数量 默认 查所有
    {
    "code": 200,
    "data": {
    "endRow": 12,
    "firstPage": 0,
    "hasNextPage": false,
    "hasPreviousPage": false,
    "isFirstPage": false,
    "isLastPage": true,
    "lastPage": 0,
    "list": [
    {
    "age": 30,
    "uid": 1,
    "username": "david"
    },
    {
    "age": 22,
    "uid": 67,
    "username": "xiaobing"
    }
    ],
    "navigateFirstPage": 0,
    "navigateLastPage": 0,
    "navigatePages": 8,
    "navigatepageNums": [],
    "nextPage": 0,
    "orderBy": "",
    "pageNum": 0,
    "pageSize": 0,
    "pages": 0,
    "prePage": 0,
    "size": 12,
    "startRow": 1,
    "total": 12
    },
    "message": "SUCCESS"
    }
     *
     *
     */
    @PostMapping("/list")
    public Result list(@RequestParam(defaultValue = "0") Integer page, @RequestParam(defaultValue = "0") Integer size) {
        PageHelper.startPage(page, size);
        List<User> list = userService.findAll();
        /**
         *     //当前页
         private int pageNum;
         //每页的数量
         private int pageSize;
         //当前页的数量
         private int size;
         //排序
         private String orderBy;

         //由于startRow和endRow不常用，这里说个具体的用法
         //可以在页面中"显示startRow到endRow 共size条数据"

         //当前页面第一个元素在数据库中的行号
         private int startRow;
         //当前页面最后一个元素在数据库中的行号
         private int endRow;
         //总记录数
         private long total;
         //总页数
         private int pages;
         //结果集
         private List<T> list;

         //前一页
         private int prePage;
         //下一页
         private int nextPage;

         //是否为第一页
         private boolean isFirstPage = false;
         //是否为最后一页
         private boolean isLastPage = false;
         //是否有前一页
         private boolean hasPreviousPage = false;
         //是否有下一页
         private boolean hasNextPage = false;
         //导航页码数
         private int navigatePages;
         //所有导航页号
         private int[] navigatepageNums;
         //导航条上的第一页
         private int navigateFirstPage;
         //导航条上的最后一页
         private int navigateLastPage;
         */
        PageInfo pageInfo = new PageInfo(list);
        return ResultGenerator.genSuccessResult(pageInfo);
    }
}
